#!/bin/bash

VAULT="$HOME/docs/notes"
LOG_FILE="$VAULT/.git_log_file"

timestamp() {
    date +"%Y-%m-%d %H:%M:%S"
}

{
    echo "----------------------------------------"
    echo "Script started at $(timestamp) on $(hostname)"
    echo "Changing directory to ~/docs/notes"
    cd "$VAULT" || exit

    echo "Running git pull..."
    git pull

    echo "Starting Obsidian..."
    /usr/bin/obsidian

    echo "Obsidian closed at $(timestamp)"

    if [[ $(git status --porcelain) ]]; then
        echo "Changes detected, committing to git..."
        git add --all
        git commit -m "Updates: $(timestamp)"

        if ! git push; then
            echo "Error pushing changes to git at $(timestamp)"
            notify-send "OBSIDIAN: Git Push Error" "An error occurred while pushing changes to the Git repository."
        else
            echo "Changes pushed to git at $(timestamp)"
        fi
    else
        echo "No changes detected, no commit needed."
    fi

    echo "Script ended at $(timestamp)"

} >> "$LOG_FILE"
